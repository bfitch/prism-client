{"version":3,"sources":["../../../src/actions/update.js"],"names":["update","entityName","UrlBuilder","http","store","loader","serialize","normalize","resetForceFetch","id","method","opts","resolvers","args","context","_","url","options","forceFetch","clearCache","variables","request","href","params","headers","data","then","res","entities","result","set","clearUrls","entity","cache"],"mappings":";;AAAA,eAAe,SAASA,MAAT,CAAgB;AAC7BC,YAD6B;AAE7BC,YAF6B;AAG7BC,MAH6B;AAI7BC,OAJ6B;AAK7BC,QAL6B;AAM7BC,WAN6B;AAO7BC,WAP6B;AAQ7BC,iBAR6B;AAS7BR;AAT6B,CAAhB,QAU4B;AAAA,MAAxC,EAAES,KAAK,IAAP,EAAaC,SAAS,KAAtB,EAAwC;AAAA,MAARC,IAAQ;;AAEzC,SAAO,CAACC,SAAD,EAAYC,IAAZ,EAAkBC,OAAlB,EAA2BC,CAA3B,KAAiC;AACtC,UAAMC,MAAM,IAAId,UAAJ,CAAeU,SAAf,EAA0BC,IAA1B,EAAgCF,KAAKK,GAArC,EAA0CP,EAA1C,CAAZ;AACA,UAAM,EAAEQ,SAAS,EAAEC,aAAa,KAAf,EAAsBC,aAAa,KAAnC,KAA6C,EAAxD,KAA6EN,IAAnF;AAAA,UAAqEO,SAArE,4BAAmFP,IAAnF;;AAEA,QAAIM,UAAJ,EAAgBf,MAAMe,UAAN;;AAEhB,UAAME,UAAUlB,KAAK;AACnBO,YADmB;AAEnBM,WAAKA,IAAIM,IAFU;AAGnBC,cAAQP,IAAIO,MAHO;AAInBC,eAASR,IAAIQ,OAJM;AAKnBC,YAAMnB,UAAUc,SAAV;AALa,KAAL,CAAhB;;AAQA,WAAOC,QAAQK,IAAR,CAAaC,OAAO;AACzB,YAAM,EAAEC,QAAF,EAAYC,MAAZ,KAAuBtB,UAAUoB,GAAV,EAAef,SAAf,EAA0BQ,SAA1B,CAA7B;AACAhB,YAAM0B,GAAN,CAAUF,QAAV;;AAEAvB,aAAO0B,SAAP;AACAvB,sBAAgBU,UAAhB;;AAEA,YAAMc,SAASJ,SAAS3B,UAAT,EAAqB4B,MAArB,CAAf;AACA7B,aAAOI,MAAM6B,KAAb,EAAoBD,MAApB;;AAEA,aAAOA,MAAP;AACD,KAXM,CAAP;AAYD,GA1BD;AA2BD","file":"update.js","sourcesContent":["export default function update({\n  entityName,\n  UrlBuilder,\n  http,\n  store,\n  loader,\n  serialize,\n  normalize,\n  resetForceFetch,\n  update\n}, { id = 'id', method = 'put', ...opts }) {\n\n  return (resolvers, args, context, _) => {\n    const url = new UrlBuilder(resolvers, args, opts.url, id);\n    const { options: { forceFetch = false, clearCache = false } = {}, ...variables } = args;\n\n    if (clearCache) store.clearCache();\n\n    const request = http({\n      method,\n      url: url.href,\n      params: url.params,\n      headers: url.headers,\n      data: serialize(variables)\n    });\n\n    return request.then(res => {\n      const { entities, result } = normalize(res, resolvers, variables);\n      store.set(entities);\n\n      loader.clearUrls();\n      resetForceFetch(forceFetch);\n\n      const entity = entities[entityName][result];\n      update(store.cache, entity);\n\n      return entity;\n    });\n  }\n}\n"]}