{"version":3,"sources":["../../src/resolver.js"],"names":["UrlBuilderFactory","Normalizer","indexAction","show","create","update","deleteAction","Resolver","store","loader","http","host","constructor","options","entityName","forceFetch","actionContext","UrlBuilder","url","resetForceFetch","value","index","opts","normalize","parse","forceFetchResource","includeResponseHeaders","storeQuery","args","obj","ids","resourceContext","context","_","Promise","all","map","nestedId","serialize","delete"],"mappings":"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","file":"resolver.js","sourcesContent":["import UrlBuilderFactory from './url-builder';\nimport Normalizer from './normalize';\nimport { indexAction, show, create, update, deleteAction } from './actions';\n\nexport default function Resolver({ store, loader, http, host }) {\n  return class Resolver {\n    constructor(options = {}) {\n      this.entityName    = options.entityName;\n      this.forceFetch    = false;\n      this.actionContext = {\n        UrlBuilder: UrlBuilderFactory((options.host || host), options.url),\n        resetForceFetch: (value) => (this.forceFetch = value),\n        entityName: this.entityName,\n        store,\n        loader,\n        http\n      }\n    }\n\n    index(opts = {}) {\n      return indexAction({\n        ...this.actionContext,\n        normalize: Normalizer(opts.parse, opts.normalize, this.entityName),\n        forceFetchResource: this.forceFetch,\n        includeResponseHeaders: (opts.includeResponseHeaders || false),\n        storeQuery: (opts.storeQuery || (args => obj => true))\n      }, opts);\n    }\n\n    show({ ids , ...opts } = {}) {\n      const resourceContext = {\n        ...this.actionContext,\n        normalize: Normalizer(opts.parse, opts.normalize, this.entityName),\n        forceFetchResource: this.forceFetch,\n        includeResponseHeaders: (opts.includeResponseHeaders || false)\n      };\n\n      if (ids) {\n        return (obj, args, context, _) => {\n          return Promise.all(obj[ids].map(nestedId => {\n            return show(resourceContext, obj, args, { ...opts, nestedId });\n          }));\n        }\n      } else {\n        return (obj, args, context, _) => {\n          return show(resourceContext, obj, args, opts);\n        }\n      }\n    }\n\n    create(opts = {}) {\n      return create({\n        ...this.actionContext,\n        normalize: Normalizer(opts.parse, opts.normalize, this.entityName),\n        serialize: (opts.serialize || this.serialize || ((args) => args)),\n        update: (opts.update || ((...args) => args))\n      }, opts);\n    }\n\n    update(opts = {}) {\n      return update({\n        ...this.actionContext,\n        normalize: Normalizer(opts.parse, opts.normalize, this.entityName),\n        serialize: (opts.serialize || this.serialize || ((args) => args)),\n        update: (opts.update || ((...args) => args))\n      }, opts);\n    }\n\n    delete(opts = {}) {\n      return deleteAction({\n        ...this.actionContext,\n        normalize: Normalizer(opts.parse, opts.normalize, this.entityName),\n        serialize: (opts.serialize || this.serialize || ((args) => args)),\n        update: (opts.update || ((...args) => args))\n      }, opts);\n    }\n  }\n}\n"]}