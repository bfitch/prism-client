{"version":3,"sources":["../../src/resolver.js"],"names":["UrlBuilderFactory","Normalizer","indexAction","show","create","update","deleteAction","Resolver","store","loader","http","host","constructor","options","entityName","normalize","parse","serialize","forceFetch","actionContext","UrlBuilder","url","resetForceFetch","value","index","opts","storeQuery","args","obj","resourceContext","ids","context","_","Promise","all","map","idValue","mutationContext","delete","normalizeOpts","forceFetchResource","includeResponseHeaders"],"mappings":"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","file":"resolver.js","sourcesContent":["import UrlBuilderFactory from './url-builder';\nimport Normalizer from './normalize';\nimport { indexAction, show, create, update, deleteAction } from './actions';\n\nexport default function Resolver({ store, loader, http, host }) {\n  return class Resolver {\n    constructor(options = {}) {\n      this.entityName    = options.entityName;\n      this.normalize     = options.normalize;\n      this.parse         = options.parse;\n      this.serialize     = options.serialize;\n      this.store         = store;\n      this.forceFetch    = false;\n      this.actionContext = {\n        UrlBuilder: UrlBuilderFactory((options.host || host), options.url),\n        resetForceFetch: (value) => (this.forceFetch = value),\n        entityName: this.entityName,\n        store,\n        loader,\n        http\n      }\n    }\n\n    index(opts = {}) {\n      const storeQuery = (opts.storeQuery || (args => obj => true))\n      return indexAction({ ...this.resourceContext(opts), storeQuery }, opts);\n    }\n\n    show({ ids , ...opts } = {}) {\n      if (ids) {\n        return (obj, args, context, _) => {\n          return Promise.all(obj[ids].map(idValue => {\n            return show(this.resourceContext(opts), obj, args, { ...opts, idValue });\n          }));\n        }\n      } else {\n        return (obj, args, context, _) => show(this.resourceContext(opts), obj, args, opts)\n      }\n    }\n\n    create(opts = {}) {\n      return create(this.mutationContext(opts), opts);\n    }\n\n    update(opts = {}) {\n      return update(this.mutationContext(opts), opts);\n    }\n\n    delete(opts = {}) {\n      return deleteAction(this.mutationContext(opts), opts);\n    }\n\n    resourceContext(opts) {\n      return {\n        ...this.actionContext,\n        normalize: Normalizer(this.entityName, this.normalizeOpts(opts)),\n        forceFetchResource: this.forceFetch,\n        includeResponseHeaders: (opts.includeResponseHeaders || false)\n      }\n    }\n\n    mutationContext(opts) {\n      return {\n        ...this.actionContext,\n        normalize: Normalizer(this.entityName, this.normalizeOpts(opts)),\n        serialize: (opts.serialize || this.serialize || ((args) => args)),\n        update: (opts.update || ((...args) => args))\n      }\n    }\n\n    normalizeOpts(opts) {\n      return {\n        normalize: opts.normalize || this.normalize,\n        parse: opts.parse || this.parse,\n        store: this.store\n      };\n    }\n  }\n}\n"]}